<%- include('partials/head.ejs') %>

<!-- Hero Section -->
<section class="hero hero-page">
    <div class="hero-overlay"></div>
    <div class="container">
        <div class="hero-content">
            <h1 class="hero-title">Faire un don</h1>
            <p class="hero-subtitle">Soutenez votre mosquée et participez au développement de notre communauté</p>
        </div>
    </div>
</section>

<!-- Impact Section -->
<section class="impact-section" style="background: var(--color-gray-50); padding: 3rem 0;">
    <div class="container">
        <h2 style="text-align: center; margin-bottom: 2.5rem;">L'impact de vos dons</h2>
        <div class="impact-grid">
            <div class="impact-card">
                <div class="impact-icon">
                    <i class="fas fa-users"></i>
                </div>
                <h3>500+</h3>
                <p>Fidèles accueillis chaque semaine</p>
            </div>
            <div class="impact-card">
                <div class="impact-icon">
                    <i class="fas fa-child"></i>
                </div>
                <h3>150+</h3>
                <p>Enfants inscrits aux cours</p>
            </div>
            <div class="impact-card">
                <div class="impact-icon">
                    <i class="fas fa-calendar-alt"></i>
                </div>
                <h3>50+</h3>
                <p>Événements organisés par an</p>
            </div>
            <div class="impact-card">
                <div class="impact-icon">
                    <i class="fas fa-hand-holding-heart"></i>
                </div>
                <h3>100+</h3>
                <p>Familles aidées chaque année</p>
            </div>
        </div>
    </div>
</section>

<!-- Donation Section -->
<section class="donation-section compact">
    <div class="container-wide">
        
        <!-- Campagnes actives -->
        <% if (donations && donations.length > 0) { %>
            <div class="active-campaigns-section">
                <h2 style="text-align: center; margin-bottom: 2rem;">Campagnes en cours</h2>
                <div class="campaigns-grid">
                    <% donations.forEach(donation => { 
                        const percentage = Math.round((donation.current_amount / donation.goal_amount) * 100);
                        let images = [];
                        if (donation.images) {
                            images = typeof donation.images === 'string' ? JSON.parse(donation.images) : donation.images;
                        }
                        const mainImage = images.length > 0 ? images[0] : '/images/default-event.jpg';
                    %>
                        <div class="campaign-card">
                            <div class="campaign-image">
                                <img src="<%= mainImage %>" alt="<%= donation.title %>">
                                <div class="campaign-badge">
                                    <i class="fas fa-heart"></i> <%= percentage %>%
                                </div>
                            </div>
                            <div class="campaign-content">
                                <h3><%= donation.title %></h3>
                                <p><%= donation.description %></p>
                                
                                <div class="campaign-progress">
                                    <div class="progress-bar-container">
                                        <div class="progress-bar" style="width: <%= percentage %>%"></div>
                                    </div>
                                    <div class="campaign-stats">
                                        <div class="stat">
                                            <span class="amount"><%= donation.current_amount.toLocaleString('fr-FR') %>€</span>
                                            <span class="label">Collectés</span>
                                        </div>
                                        <div class="stat">
                                            <span class="amount"><%= donation.goal_amount.toLocaleString('fr-FR') %>€</span>
                                            <span class="label">Objectif</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <% if (donation.end_date) { %>
                                    <div class="campaign-deadline">
                                        <i class="far fa-calendar"></i>
                                        Fin le <%= new Date(donation.end_date).toLocaleDateString('fr-FR') %>
                                    </div>
                                <% } %>
                            </div>
                        </div>
                    <% }); %>
                </div>
            </div>
        <% } %>
        
        <div class="donation-intro" style="margin-top: <%= donations && donations.length > 0 ? '3rem' : '0' %>">
            <h2>Faire un don</h2>
            <p class="lead">
                Soutenez le fonctionnement général de notre mosquée ou une campagne spécifique.
            </p>
        </div>
        
        <div class="donation-grid">
            <!-- Formulaire de don -->
            <div class="donation-form-container">
                <h3>Choisissez le montant de votre don</h3>
                
                <form id="donationForm" class="donation-form">
                    <!-- Montants prédéfinis -->
                    <div class="amount-options">
                        <button type="button" class="amount-btn" data-amount="20">20€</button>
                        <button type="button" class="amount-btn" data-amount="50">50€</button>
                        <button type="button" class="amount-btn" data-amount="100">100€</button>
                        <button type="button" class="amount-btn" data-amount="200">200€</button>
                    </div>
                    
                    <!-- Montant personnalisé -->
                    <div class="form-group">
                        <label for="customAmount">Ou saisissez un montant personnalisé</label>
                        <div class="input-group">
                            <input 
                                type="number" 
                                id="customAmount" 
                                name="amount" 
                                min="5" 
                                placeholder="Montant"
                                class="form-control"
                            >
                            <span class="input-group-text">€</span>
                        </div>
                    </div>
                    
                    <!-- Type de don -->
                    <div class="form-group">
                        <label>Type de don</label>
                        <div class="donation-type-options">
                            <label class="radio-card">
                                <input type="radio" name="donationType" value="ponctuel" checked>
                                <span class="radio-card-content">
                                    <i class="fas fa-hand-holding-heart"></i>
                                    <strong>Don ponctuel</strong>
                                </span>
                            </label>
                            <label class="radio-card">
                                <input type="radio" name="donationType" value="mensuel">
                                <span class="radio-card-content">
                                    <i class="fas fa-calendar-check"></i>
                                    <strong>Don mensuel</strong>
                                </span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Affectation du don -->
                    <div class="form-group">
                        <label for="donationPurpose">Affecter mon don à</label>
                        <select id="donationPurpose" name="purpose" class="form-control">
                            <option value="general">Fonctionnement général</option>
                            <% if (donations && donations.length > 0) { %>
                                <% donations.forEach(donation => { %>
                                    <option value="campaign_<%= donation.id %>"><%= donation.title %></option>
                                <% }); %>
                            <% } %>
                            <option value="travaux">Travaux et entretien</option>
                            <option value="education">Éducation et enseignement</option>
                            <option value="solidarite">Actions solidaires</option>
                            <option value="jeunesse">Activités jeunesse</option>
                        </select>
                    </div>
                    
                    <!-- Informations personnelles -->
                    <div class="form-group">
                        <label for="donorName">Nom complet *</label>
                        <input 
                            type="text" 
                            id="donorName" 
                            name="name" 
                            required 
                            class="form-control"
                            placeholder="Votre nom"
                        >
                    </div>
                    
                    <div class="form-group">
                        <label for="donorEmail">Email *</label>
                        <input 
                            type="email" 
                            id="donorEmail" 
                            name="email" 
                            required 
                            class="form-control"
                            placeholder="votre@email.com"
                        >
                    </div>
                    
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="newsletter">
                            <span>Je souhaite recevoir les actualités de la mosquée</span>
                        </label>
                    </div>
                    
                    <!-- Bouton de soumission -->
                    <button type="submit" class="btn btn-primary btn-lg btn-block">
                        <i class="fas fa-lock"></i>
                        Procéder au paiement sécurisé
                    </button>
                    
                    <p class="form-note">
                        <i class="fas fa-shield-alt"></i>
                        Paiement 100% sécurisé par Stripe
                    </p>
                </form>
            </div>
            
            <!-- Sidebar informations -->
            <div class="donation-sidebar">
                <div class="donation-info-card">
                    <h4>Pourquoi donner ?</h4>
                    <ul class="info-list">
                        <li>
                            <i class="fas fa-mosque"></i>
                            <span>Entretien et fonctionnement de la mosquée</span>
                        </li>
                        <li>
                            <i class="fas fa-book-quran"></i>
                            <span>Programmes éducatifs et cours</span>
                        </li>
                        <li>
                            <i class="fas fa-users"></i>
                            <span>Activités communautaires</span>
                        </li>
                        <li>
                            <i class="fas fa-hands-helping"></i>
                            <span>Actions caritatives et solidaires</span>
                        </li>
                    </ul>
                </div>
                
                <div class="donation-info-card">
                    <h4>Avantages fiscaux</h4>
                    <p>
                        Vos dons à la mosquée peuvent être éligibles à une réduction fiscale. 
                        Un reçu fiscal vous sera envoyé par email.
                    </p>
                    <div class="tax-benefit">
                        <span class="tax-label">Exemple :</span>
                        <p>Pour un don de <strong>100€</strong>, votre don ne vous coûte réellement que <strong>34€</strong> après déduction fiscale (66%).</p>
                    </div>
                </div>
                
                <div class="donation-info-card">
                    <h4>Autres moyens de donner</h4>
                    <ul class="payment-methods">
                        <li>
                            <i class="fas fa-university"></i>
                            <span>Virement bancaire</span>
                        </li>
                        <li>
                            <i class="fas fa-money-check"></i>
                            <span>Chèque</span>
                        </li>
                        <li>
                            <i class="fas fa-hand-holding-usd"></i>
                            <span>Sur place à la mosquée</span>
                        </li>
                    </ul>
                    <a href="/contact" class="btn btn-outline btn-sm">
                        Plus d'informations
                    </a>
                </div>
                
                <div class="donation-info-card trust-indicators">
                    <h4>Transparence et confiance</h4>
                    <p>
                        <i class="fas fa-check-circle"></i>
                        Association loi 1901
                    </p>
                    <p>
                        <i class="fas fa-check-circle"></i>
                        Paiements sécurisés
                    </p>
                    <p>
                        <i class="fas fa-check-circle"></i>
                        Reçus fiscaux automatiques
                    </p>
                </div>
            </div>
        </div>
    </div>
</section>

<%- include('partials/footer.ejs') %>
<%- include('partials/foot.ejs') %>
